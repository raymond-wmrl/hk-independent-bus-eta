(this["webpackJsonphk-independent-bus-eta"]=this["webpackJsonphk-independent-bus-eta"]||[]).push([[0],{100:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(15),o=n(7),c=n(0),r=n(162),i=n(77),s=n(16),u=function(e){var t=Object(c.useContext)(s.b),n=t.db.routeList,u=t.isVisible,d=e.split("/"),b=Object(o.a)(d,2),p=b[0],g=b[1],m=n[p]||l,j=Object(c.useState)(null),f=Object(o.a)(j,2),h=f[0],O=f[1],v=Object(r.a)().i18n.language;return Object(c.useEffect)((function(){var e=!0,t=function(){return u&&"prerendering"!==navigator.userAgent?Object(i.fetchEtas)(Object(a.a)(Object(a.a)({},m),{},{seq:parseInt(g,10),language:v})).then((function(t){e&&O(t)})):(O(null),new Promise((function(e){return e([])})))},n=setInterval((function(){t()}),3e4);return t(),function(){e=!1,clearInterval(n)}}),[u]),h},l={co:[""],stops:{"":[""]},dest:{zh:"",en:""},bound:"",nlbId:0,fares:[],faresHoliday:[]}},112:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var a=n(7),o={266:[0,0,1,1,1,0,0],271:[0,1,1,1,1,0,0],272:[0,0,0,0,0,1,0],287:[0,1,1,1,1,1,0],288:[0,0,0,0,0,0,1],319:[0,1,1,1,1,1,1],320:[1,0,0,0,0,0,0],415:[0,1,1,1,1,1,0],416:[1,0,0,0,0,0,1],447:[0,1,1,1,1,1,1],448:[1,0,0,0,0,0,0],480:[1,0,0,0,0,0,1],511:[1,1,1,1,1,1,1],31:[0,1,1,1,1,1,0],63:[0,1,1,1,1,1,1]},c=function(e,t){var n=24*e*60;return n+=60*parseInt(t.slice(0,2),10)+parseInt(t.slice(2),10)},r=function(e,t){return e.includes("".concat(t.getFullYear()).concat(("0"+(t.getMonth()+1)).slice(-2)).concat(("0"+t.getDate()).slice(-2)))},i=function(e,t){if(!e)return!0;var n=!1,r=new Date,i=c(t?0:r.getDay(),("0"+r.getHours()).slice(-2)+("0"+r.getMinutes()).slice(-2));return Object.entries(e).forEach((function(e){var t=Object(a.a)(e,2),r=t[0],s=t[1];o[r].forEach((function(e,t){e&&Object.entries(s).forEach((function(e){var o,r,s,u=Object(a.a)(e,2),l=u[0],d=u[1],b=c(t,l),p=c(t,d?d[0]:l);n=n||(r=p,(o=b)-60<=(s=i)&&s<=r+60||o-60<=s+10080&&s+10080<=r+60)}))}))})),n}},137:function(e,t,n){"use strict";var a=n(0),o=n(229),c=n(119),r=n(162),i=n(16),s=n(100),u=n(1);t.a=function(e){var t=e.routeId,n=e.seq,l=e.containerClass,d=void 0===l?"":l,b=e.showStopName,p=void 0!==b&&b,g=Object(r.a)(),m=g.t,j=g.i18n,f=Object(a.useContext)(i.b),h=f.db,O=h.routeList,v=h.stopList,x=f.etaFormat,y=Object(s.a)("".concat(t,"/").concat(n));if(null==y)return Object(u.jsx)("div",{className:d,children:Object(u.jsx)(o.a,{size:20,style:{}})});var w=function(e){if(!e)return"";var t=Math.round((new Date(e).getTime()-(new Date).getTime())/60/1e3);return"exact"===x&&Number.isInteger(t)?e.substr(11,5):t<1?"- "+m("\u5206\u9418"):Number.isInteger(t)?t+" "+m("\u5206\u9418"):void 0},k=Object.values(O[t].stops)[0][n];return Object(u.jsxs)("div",{className:d,children:[p?Object(u.jsx)(c.a,{variant:"caption",children:v[k].name[j.language]}):null,0===y.length?m("\u672a\u6709\u73ed\u6b21\u8cc7\u6599"):y.map((function(e,t){return Object(u.jsxs)(c.a,{variant:"subtitle1",children:[w(e.eta)," -"," ",e.remark[j.language]?e.remark[j.language]:""," ",m(e.co)]},"route-".concat(t))}))]})}},138:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(7),o=n(0),c=n.n(o),r=n(1),i=c.a.createContext({}),s=function(e){var t=Object(o.useState)({start:null,end:null}),n=Object(a.a)(t,2),c=n[0],s=n[1],u=Object(o.useState)("ready"),l=Object(a.a)(u,2),d=l[0],b=l[1],p=Object(o.useState)([]),g=Object(a.a)(p,2),m=g[0],j=g[1],f=Object(o.useState)({resultIdx:0,stopIdx:[0,0]}),h=Object(a.a)(f,2),O=h[0],v=h[1];return Object(r.jsx)(i.Provider,{value:{locations:c,setLocations:s,status:d,setStatus:b,result:m,setResult:j,resultIdx:O,setResultIdx:v},children:e.children})};t.b=i},14:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"i",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"d",(function(){return b}));var a=function(e,t){var n=e.lat*Math.PI/180,a=t.lat*Math.PI/180,o=(t.lat-e.lat)*Math.PI/180,c=(t.lng-e.lng)*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},o={lat:22.302711,lng:114.177216},c=function(e){return e&&"number"===typeof e.lat&&isFinite(e.lat)&&"number"===typeof e.lng&&isFinite(e.lng)?e:o},r=function(e,t){return Math.abs(e.lat-t.lat)<1e-7&&Math.abs(e.lng-t.lng)<1e-7},i=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},s=function(e){"vibrate"in navigator&&navigator.vibrate(e)},u=function(e,t){return navigator.share?navigator.share({title:t,url:e}):navigator.clipboard?navigator.clipboard.writeText(e):new Promise((function(e){return e("")}))},l=function(e){var t=e.title,n=e.description,a=e.lang;document.querySelector('meta[name="description"]')&&(document.title=t,document.querySelector('meta[name="description"]').setAttribute("content",n),document.querySelector('link[rel="canonical"]').setAttribute("href","https://hkbus.app".concat(window.location.pathname)),document.querySelector("html").setAttribute("lang","zh"===a?"zh-Hant":a),document.querySelector('link[rel="alternative"][hreflang="en"]').setAttribute("href","https://hkbus.app"+window.location.pathname.replace("/".concat(a),"/en")),document.querySelector('link[rel="alternative"][hreflang="zh-Hant"]').setAttribute("href","https://hkbus.app"+window.location.pathname.replace("/".concat(a),"/zh")),document.querySelector('link[rel="alternative"][hreflang="x-default"]').setAttribute("href","https://hkbus.app"+window.location.pathname.replace("/".concat(a),"/zh")),document.querySelector('meta[property="og:title"]').setAttribute("content",t),document.querySelector('meta[property="og:url"]').setAttribute("content","https://hkbus.app".concat(window.location.pathname)),document.querySelector('meta[property="og:description"]').setAttribute("content",n),document.querySelector('meta[name="twitter:title"]').setAttribute("content",t),document.querySelector('meta[name="twitter:description"]').setAttribute("content",n))},d=function(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))},b=function(e){return e&&0===Object.keys(e).length&&e.constructor===Object}},156:function(e){e.exports=JSON.parse('{"en":{"translation":{"\u5df4\u58eb\u5230\u7ad9\u9810\u5831 App \uff08\u514d\u8cbb\u7121\u5ee3\u544a\uff09":"HK Bus ETA App (Free and Ad-free)","\u5df4\u58eb\u5230\u7ad9\u9810\u5831":"HK BUS ETA","\u9ede\u5c0d\u9ede\u8def\u7dda\u641c\u5c0b":"Point to point Route Search","kmb":"KMB","ctb":"CTB","nwfb":"NWFB","nlb":"NLB","lrtfeeder":"MTR","\u7c73":"m","\u79d2":"s","\u7531":"From","\u5f80":"To","\u5206\u9418":"min","\u5e38\u7528":"Home","\u641c\u5c0b":"Search","\u898f\u5283":"P2P","\u8a2d\u5b9a":"Settings","\u53d6\u6d88":"Clear","\u5df4\u58eb\u7dda":"Route","\u4f60\u7684\u4f4d\u7f6e":"Your location","\u76ee\u7684\u5730":"Destination","\u93c8\u7d50\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f":"Link copied to clipboard","\u8cc7\u6599\u66f4\u65b0\u4e2d":"Data updating","\u672a\u6709\u73ed\u6b21\u8cc7\u6599":"No information available","\u67b6\u69cb\u7248\u672c":"Schema Version","\u66f4\u65b0\u6642\u9593":"Last Updated","\u5730\u7406\u4f4d\u7f6e\u5b9a\u4f4d\u529f\u80fd":"Geolocation","\u958b\u555f":"On","\u958b\u555f\u4e2d...":"Switching...","\u95dc\u9589":"Off","\u7121\u6cd5\u7372\u5f97\u5730\u7406\u4f4d\u7f6e\u5b9a\u4f4d\u529f\u80fd\u6b0a\u9650":"Permission denied: Geolocation","\u4e00\u9375\u6e05\u7a7a\u7528\u6236\u8a18\u9304":"Clear Your Usage Records","\u5305\u62ec\u9396\u5b9a\u548c\u5e38\u7528\u5831\u6642":"Includes saved and commonly used ETA","\u4ea4\u901a\u8cc7\u6599\u4f86\u6e90":"ETA data source","\u8cc7\u6599\u4e00\u7dda\u901a":"DATA.GOV.HK","\u6350\u6b3e\u652f\u6301":"Donate","\u8907\u88fd\u61c9\u7528\u7a0b\u5f0f\u93c8\u7d50":"Copy App URL","\u7d93\u4e0d\u540c\u5a92\u4ecb\u5206\u4eab\u7d66\u89aa\u53cb":"Share it!","Telegram \u4ea4\u6d41\u5340":"Telegram group","\u6b61\u8fce\u610f\u898b\u53ca\u6280\u8853\u4ea4\u6d41":"Comments & technology sharing are welcomed","\u8eca\u8cbb":"Fee","\u7279\u5225\u73ed":"Special","home-page-description":"Ad-free mobile application for checking bus routes, stops, estimated time of arrival(ETA) of Kowloon Motor Bus Co. (KMB), Long Win Bus (LWB), CityBus (CTB), New World First Bus (NWFB) and New Lantao Bus (NLB) - HK Bus ETA App","route-board-page-description":"Simple & clean route searching interface to search over 1800 routes and 8800 stops among Kowloon Motor Bus Co. (KMB), Long Win Bus (LWB), CityBus (CTB), New World First Bus (NWFB) and New Lantao Bus (NLB), covering Hong Kong Island, Kowloon, New Territories and Lantau Island - HK Bus ETA App","setting-page-description":"Update the database, clean up usage record, check out the source code, join the telegram group and donate - HK Bus ETA App","route-search-page-description":"Point-to-Point route search across Kowloon Motor Bus Co. (KMB), Long Win Bus (LWB), CityBus (CTB), New World First Bus (NWFB) and New Lantao Bus (NLB) - HK Bus ETA App","\u5716\u793a\u4f86\u6e90":"Icons from","\u5b89\u88dd":"Install the App","\u5b89\u88dd\u5df4\u58eb\u9810\u5831 App \u5230\u88dd\u7f6e":"Install HK BUS ETA","\u5b89\u88dd\u6b65\u9a5f":"Installation Steps","\u9ed1\u591c\u6a21\u5f0f":"Dark mode","\u8def\u7dda\u7be9\u9078":"Route filtering","\u53ea\u986f\u793a\u73fe\u6642\u8def\u7dda":"Show ONLY operating routes","\u986f\u793a\u6240\u6709\u8def\u7dda":"Show ALL routes","\u7701\u96fb\u6a21\u5f0f":"Energy saving mode","\u5831\u6642\u683c\u5f0f":"ETA foramt","\u5230\u7ad9\u6642\u5dee":"Minutes remaining","\u5230\u7ad9\u6642\u9593":"Clock time","\u8eca\u7ad9":"Bus station","\u5730\u5716\u529f\u80fd":"Map Function","\u5716\u6a19\u4f86\u6e90":"Logo source","\u627e\u4e0d\u5230\u5408\u9069\u7684\u5df4\u58eb\u8def\u7dda":"No available routes found","\u7528 Safari \u958b":"Open this website with Safari","\u5206\u4eab":"Share","\u52a0\u81f3\u4e3b\u756b\u9762":"Add to Home Screen","\u7528 Chrome \u958b":"Open this website with Chrome","\u53f3\u4e0a\u9078\u9805":"Tap the menu icon (3 dots in the upper right-hand corner)","\u65b0\u589e\u81f3\u4e3b\u756b\u9762 / \u5b89\u88dd\u61c9\u7528\u7a0b\u5f0f":"Add to Home screen / Install the app","Route Search header":"Point-to-Point Bus Route Search","Route Search description":"Point to point search","Route Search constraint":"Constraints\uff1a","Route Search caption 1":"Max. transfer once","Route Search caption 2":"Max. walking distance is 500m","Route Search caption 3":"Scheduled bus at the first station","\u661f\u671f\u4e00\u81f3\u4e94":"Monday to Friday","\u661f\u671f\u4e00\u81f3\u516d":"Monday to Saturday","\u661f\u671f\u516d\u81f3\u65e5":"Saturday & Sunday","\u661f\u671f\u4e8c\u81f3\u56db":"Tuesday to Thursday","\u661f\u671f\u4e00\u81f3\u56db":"Monday to Thursday","\u661f\u671f\u4e94":"Friday","\u661f\u671f\u516d":"Saturday","\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f":"Sunday & Public Holidays","\u6240\u6709\u65e5\u5b50":"All day","\u6642\u9593\u8868":"skd"}},"zh":{"translation":{"kmb":"\u4e5d\u5df4","ctb":"\u57ce\u5df4","nwfb":"\u65b0\u5df4","nlb":"\u65b0\u5927\u5dbc\u5c71\u5df4\u58eb","lrtfeeder":"\u6e2f\u9435","Dashboard":"\u5100\u8868\u677f","home-page-description":"\u7121\u5ee3\u544a\u624b\u6a5f\u61c9\u7528\u7a0b\u5f0f\u67e5\u95b1\u5df4\u58eb\u7dda\u3001\u8eca\u7ad9\u3001\u9810\u8a08\u5230\u9054\u6642\u9593\uff0c\u8def\u7dda\u76e1\u5305\u4e5d\u9f8d\u5df4\u58eb(\u4e5d\u5df4)\u3001\u9f8d\u904b\u5df4\u58eb\u3001\u65b0\u4e16\u754c\u7b2c\u4e00\u5df4\u58eb(\u65b0\u5df4)\u3001\u57ce\u5df4\u3001\u65b0\u5927\u5dbc\u5c71\u5df4\u58eb - \u5df4\u58eb\u5230\u7ad9\u9810\u5831 App","route-board-page-description":"\u900f\u904e\u7c21\u6f54\u6e05\u6663\u7684\u641c\u5c0b\u4ecb\u9762\uff0c\u8f15\u9b06\u67e5\u627e\u4e5d\u5df4\u3001\u9f8d\u904b\u3001\u65b0\u5df4\u3001\u57ce\u5df4\u3001\u65b0\u5927\u5dbc\u5c71\u5df4\u58eb\u5408\u5171\u8d85\u904e 1800 \u689d\u5df4\u58eb\u8def\u7dda\uff0c8800 \u500b\u8eca\u7ad9\uff0c\u8def\u7dda\u8986\u84cb\u6e2f\u5cf6\u3001\u4e5d\u9f8d\u3001\u65b0\u754c\u3001\u5927\u5dbc\u5c71 - \u5df4\u58eb\u5230\u7ad9\u9810\u5831 App","setting-page-description":"\u91cd\u7f6e\u5df4\u58eb\u8def\u7dda\u8cc7\u6599\uff0c\u522a\u9664\u4f7f\u7528\u8a18\u9304\uff0c\u67e5\u770b\u539f\u59cb\u78bc\uff0c\u52a0\u5165 Telegram \u4ea4\u6d41\u7fa4\u7d44\uff0c\u4ea6\u53ef\u6350\u6b3e\u652f\u6301 - \u5df4\u58eb\u5230\u7ad9\u9810\u5831 App","route-search-page-description":"\u9ede\u5c0d\u9ede\u641c\u5c0b\u53ef\u884c\u5df4\u58eb\u7dda\uff0c\u5408\u7406\u6b65\u8ddd\u4e0b\uff0c\u6a6b\u8a87\u4e5d\u5df4\u3001\u9f8d\u904b\u3001\u65b0\u5df4\u3001\u57ce\u5df4\u3001\u65b0\u5927\u5dbc\u5c71\u5df4\u58eb\u7684\u5df4\u58eb\u7dda - \u5df4\u58eb\u5230\u7ad9\u9810\u5831 App","Route Search header":"\u9ede\u5c0d\u9ede\u5df4\u58eb\u8def\u7dda\u641c\u5c0b","Route Search description":"\u641c\u5c0b\u7531\u8d77\u9ede\u5230\u7d42\u9ede\u7684\u8def\u7dda","Route Search constraint":"\u689d\u4ef6\u5982\u4e0b\uff1a","Route Search caption 1":"\u6700\u591a\u8f49\u4e58\u4e00\u73ed\u8eca","Route Search caption 2":"\u8d77\u9ede\u7d42\u9ede\u548c\u8eca\u7ad9\u4e4b\u9593\u7684\u6700\u5927\u6b65\u884c\u8ddd\u96e2 500m","Route Search caption 3":"App \u4ea6\u6703\u78ba\u8a8d\u8def\u7dda\u982d\u7ad9\u6709\u5373\u5c07\u51fa\u767c\u7684\u8eca\uff0c\u4ee5\u6e1b\u5c11\u904e\u91cf\u7684\u641c\u5c0b\u7d50\u679c"}}}')},16:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n(15),o=n(7),c=n(0),r=n.n(c),i=n(14),s=n(80),u=n(31),l=n(1),d=r.a.createContext(null),b={lat:22.302711,lng:114.177216},p=function(e){return e instanceof Object&&null!==e&&void 0!==e&&"number"===typeof e.lat&&"number"===typeof e.lng},g=function(e){return"exact"===e||"diff"===e},m=function(e){return!e.some((function(e){return"string"!==typeof e}))},j=function(e){return"dark"===e||"light"===e},f=function(e){return e instanceof Object&&null!==e&&void 0!==e&&!Object.entries(e).some((function(e){return"number"!==typeof e}))},h=function(e){var t=e.workbox,n=e.children,r=Object(c.useContext)(s.b),h=r.db.routeList,v=Object(c.useState)((function(){var e,t=localStorage.getItem("colorMode")||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),n=localStorage.getItem("geoPermission"),a=JSON.parse(localStorage.getItem("geolocation")),o=localStorage.getItem("etaFormat"),c=JSON.parse(localStorage.getItem("savedEtas")),r=JSON.parse(localStorage.getItem("hotRoute"));return{searchRoute:"",selectedRoute:"1-1-CHUK-YUEN-ESTATE-STAR-FERRY",geoPermission:(e=n,"opening"===e||"granted"===e||"denied"===e||null===e?n:null),geolocation:p(a)?a:b,hotRoute:f(r)?r:{},savedEtas:Array.isArray(c)&&m(c)?c:[],isRouteFilter:!!JSON.parse(localStorage.getItem("isRouteFilter"))||!1,possibleChar:O("",h)||[],etaFormat:g(o)?o:"diff",colorMode:j(t)?t:"light",energyMode:!!JSON.parse(localStorage.getItem("energyMode"))||!1,isVisible:!0}})),x=Object(o.a)(v,2),y=x[0],w=x[1],k=y.geoPermission,C=Object(c.useCallback)((function(e){w("function"===typeof e?Object(u.c)(e):Object(u.b)(e))}),[]),S=Object(c.useCallback)((function(e){C((function(t){t.searchRoute=e}))}),[C]);Object(c.useEffect)((function(){if("granted"===k)try{var e=navigator.geolocation.watchPosition((function(e){var t=e.coords,n=t.latitude,a=t.longitude;I({lat:n,lng:a})}));T.current=e}catch(n){console.error("cannot watch position",n)}var t=function(){w(Object(u.c)((function(e){e.isVisible=!document.hidden})))};return window.addEventListener("visibilitychange",t),function(){T.current&&navigator.geolocation.clearWatch(T.current),window.removeEventListener("visibilitychange",t)}}),[]);var I=Object(c.useCallback)((function(e){w(Object(u.c)((function(t){t.geolocation=e,localStorage.setItem("geolocation",JSON.stringify(e))})))}),[]),M=Object(c.useCallback)((function(e){C((function(t){t.geoPermission=e}))}),[C]),T=Object(c.useRef)(null),L=Object(c.useCallback)((function(e,t){if("opening"===e){M("opening");var n=navigator.geolocation.watchPosition((function(e){var t=e.coords,n=t.latitude,a=t.longitude;I({lat:n,lng:a}),M("granted"),localStorage.setItem("geoPermission","granted")}),(function(){M("denied"),localStorage.setItem("geoPermission","denied"),t&&t()}));T.current=n}else T.current&&(navigator.geolocation.clearWatch(T.current),T.current=null,M(e),localStorage.setItem("geoPermission",e))}),[M,I]),R=Object(c.useCallback)((function(){w(Object(u.c)((function(e){var t=!e.isRouteFilter;localStorage.setItem("isRouteFilter",JSON.stringify(t)),e.isRouteFilter=t})))}),[]),N=Object(c.useCallback)((function(){w(Object(u.c)((function(e){var t="diff"===e.etaFormat?"exact":"diff";localStorage.setItem("etaFormat",t),e.etaFormat=t})))}),[]),E=Object(c.useCallback)((function(){w(Object(u.c)((function(e){var t="dark"===e.colorMode?"light":"dark";localStorage.setItem("colorMode",t),e.colorMode=t})))}),[]),A=Object(c.useCallback)((function(){w(Object(u.c)((function(e){var t=!e.energyMode;localStorage.setItem("energyMode",JSON.stringify(t)),e.energyMode=t})))}),[]),B=Object(c.useCallback)((function(e){Object(i.i)(1),setTimeout((function(){w(Object(u.c)((function(t){var n,a=t.searchRoute;switch(e){case"b":n=a.slice(0,-1);break;case"c":n="";break;default:n=a+e}t.searchRoute=n,t.possibleChar=O(n,h)})))}),0)}),[h]),F=Object(c.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";w(Object(u.c)((function(n){n.selectedRoute="".concat(e,"/").concat(t),t&&(n.hotRoute[e+"/"+t]?n.hotRoute[e+"/"+t]=n.hotRoute[e+"/"+t]+1:n.hotRoute[e+"/"+t]=1,localStorage.setItem("hotRoute",JSON.stringify(Object(u.a)(n.hotRoute))))})))}),[]),P=Object(c.useCallback)((function(e){w(Object(u.c)((function(t){var n=t.savedEtas;if(n.includes(e))return n.splice(n.indexOf(e),1),localStorage.setItem("savedEtas",JSON.stringify(Object(u.a)(n))),void(t.savedEtas=n);var a=n.concat(e).filter((function(e,t,n){return n.indexOf(e)===t}));localStorage.setItem("savedEtas",JSON.stringify(a)),t.savedEtas=a})))}),[]),z=Object(c.useCallback)((function(){w(Object(u.c)((function(e){e.hotRoute={},e.geolocation=b,e.savedEtas=[]})))}),[]),D=Object(c.useMemo)((function(){return Object(a.a)(Object(a.a)(Object(a.a)({},r),y),{},{setSearchRoute:S,updateSearchRouteByButton:B,updateSelectedRoute:F,updateGeolocation:I,updateSavedEtas:P,resetUsageRecord:z,updateGeoPermission:L,toggleRouteFilter:R,toggleEtaFormat:N,toggleColorMode:E,toggleEnergyMode:A,workbox:t})}),[r,y,S,B,F,I,P,z,L,R,N,E,A,t]);return Object(l.jsx)(d.Provider,{value:D,children:n})};t.b=d;var O=function(e,t){if(null==t)return[];var n={};return Object.entries(t).forEach((function(t){if(t[0].startsWith(e.toUpperCase())){var a=t[0].slice(e.length,e.length+1);n[a]=isNaN(n[a])?1:n[a]+1}})),Object.entries(n).map((function(e){return e[0]})).filter((function(e){return"-"!==e}))}},178:function(e,t,n){},182:function(e,t,n){},203:function(e,t){},205:function(e,t){},222:function(e,t,n){"use strict";n.r(t);var a=n(7),o=n(0),c=n.n(o),r=n(39),i=n.n(r),s=n(22),u=n.n(s),l=(n(178),n(15)),d=n(3),b=n(103),p=(n(182),n(183),n(157)),g=n(265),m=n(277),j=n(18),f=n(28),h=n(23),O=n(60),v=n(266),x=n(294),y=n(5),w=n(16),k=n(119),C=n(267),S=n(278),I=n(279),M=n(268),T=n(162),L=n(14),R=n(1),N=function(){var e=Object(o.useContext)(w.b),t=e.searchRoute,n=e.setSearchRoute,a=e.db.routeList,c=e.colorMode,r=Object(j.j)().path,i=Object(T.a)(),s=i.t,u=i.i18n,l=Object(j.h)(),d=Object(j.g)();return Object(o.useMemo)((function(){return Object(R.jsxs)(B,{className:A.toolbar,children:[Object(R.jsx)(f.b,{to:"/".concat(u.language,"/board"),onClick:function(e){e.preventDefault(),Object(L.i)(1),d.push("/".concat(u.language,"/board"))},rel:"nofollow",children:Object(R.jsx)(k.a,{component:"h1",variant:"subtitle2",className:A.appTitle,children:s("\u5df4\u58eb\u5230\u7ad9\u9810\u5831")})}),Object(R.jsx)(C.a,{id:"searchInput",className:A.searchRouteInput,type:"text",value:t,placeholder:s("\u5df4\u58eb\u7dda"),onChange:function(e){(e.target.value.toUpperCase()in a||e.target.value in a)&&(document.activeElement.blur(),d.push("/".concat(u.language,"/route/").concat(e.target.value))),n(e.target.value)},onFocus:function(e){Object(L.i)(1),"prerendering"!==navigator.userAgent&&Object(L.a)()&&document.activeElement.blur(),d.replace("/".concat(u.language,"/board"))},disabled:r.includes("route")}),Object(R.jsxs)(F,{className:A.languageTabs,value:u.language,onChange:function(e,t){return n=t,Object(L.i)(1),d.replace(l.pathname.replace("/"+u.language,"/"+n)),void u.changeLanguage(n);var n},children:[Object(R.jsx)(S.a,{disableRipple:!0,className:A.languageTab,id:"en-selector",value:"en",label:"En",component:f.b,to:"".concat(window.location.pathname.replace("/zh","/en")),onClick:function(e){return e.preventDefault()}}),Object(R.jsx)(S.a,{disableRipple:!0,className:A.languageTab,id:"zh-selector",value:"zh",label:"\u7e41",component:f.b,to:"".concat(window.location.pathname.replace("/en","/zh")),onClick:function(e){return e.preventDefault()}})]})]})}),[t,u.language,l.pathname,c])},E="header",A={toolbar:"".concat(E,"-toolbar"),appTitle:"".concat(E,"-appTitle"),searchRouteInput:"".concat(E,"-searchRouteInput"),languageTabs:"".concat(E,"-languagetabs"),languageTab:"".concat(E,"-languagetab")},B=Object(y.a)(I.a)((function(e){var t,n=e.theme;return t={},Object(d.a)(t,"& .".concat(A.appTitle),{color:"dark"===n.palette.mode?n.palette.primary.main:n.palette.text.primary}),Object(d.a)(t,"&.".concat(A.toolbar),{backgroundColor:"dark"===n.palette.mode?n.palette.background.default:n.palette.primary.main,"& a":{color:"black",textDecoration:"none"},display:"flex",justifyContent:"space-between",zIndex:2*n.zIndex.drawer}),Object(d.a)(t,"& .".concat(A.searchRouteInput),{maxWidth:"50px","& input":{textAlign:"center"},"& input::before":{borderBottom:"1px ".concat(n.palette.text.primary," solid")}}),t})),F=Object(y.a)(M.a)((function(e){var t,n=e.theme;return t={},Object(d.a)(t,"&.".concat(A.languageTabs),{borderBottom:"none",minHeight:24,"& .MuiTabs-indicator":{backgroundColor:"transparent"}}),Object(d.a)(t,"& .".concat(A.languageTab),{textTransform:"none",minWidth:36,minHeight:24,fontWeight:900,marginRight:n.spacing(0),fontSize:"15px",opacity:1,padding:"6px 6px","&.MuiTab-root":{color:n.palette.text.primary,borderRadius:"30px",padding:"0px 10px 0px 10px"},"&.Mui-selected":{"&.MuiTab-root":{color:"black",backgroundColor:"dark"===n.palette.mode?n.palette.primary.main:n.palette.background.paper}}}),t})),P=n(280),z=n(281),D=n(145),H=n.n(D),W=n(146),q=n.n(W),U=n(148),K=n.n(U),J=n(147),V=n.n(J),_=n(149),$=n.n(_),Y=function(){var e=Object(T.a)(),t=e.t,n=e.i18n,a=Object(j.h)(),c=Object(o.useContext)(w.b),r=c.selectedRoute,i=c.colorMode,s=Object(j.g)(),u=function(e,t){t.preventDefault(),Object(L.i)(1),setTimeout((function(){return s.push(e)}),0)};return Object(o.useMemo)((function(){return Object(R.jsxs)(Q,{value:a.pathname.replace(/(.*)\/[0-9]*?$/,"$1"),showLabels:!0,classes:{root:Z.root},children:[Object(R.jsx)(P.a,{label:t("\u5e38\u7528"),component:f.b,to:"/".concat(n.language),onClick:function(e){return u("/".concat(n.language),e)},value:"/".concat(n.language),icon:Object(R.jsx)(H.a,{}),classes:{root:"footer-actionItem",selected:"footer-selected"}}),Object(R.jsx)(P.a,{label:t("\u641c\u5c0b"),component:f.b,to:"/".concat(n.language,"/board"),onClick:function(e){return u("/".concat(n.language,"/board"),e)},value:"/".concat(n.language,"/board"),icon:Object(R.jsx)(q.a,{}),classes:{root:"footer-actionItem",selected:"footer-selected"}}),Object(R.jsx)(P.a,{label:r.split("-")[0],component:f.b,to:"/".concat(n.language,"/route/").concat(r.replace(/(.*)\/.*$/,"$1").toLowerCase()),onClick:function(e){return u("/".concat(n.language,"/route/").concat(r.toLowerCase()),e)},value:"/".concat(n.language,"/route/").concat(r.replace(/(.*)\/.*$/,"$1").toLowerCase()),icon:Object(R.jsx)(V.a,{}),style:{textTransform:"uppercase"},classes:{root:"footer-actionItem",selected:"footer-selected"}}),Object(R.jsx)(P.a,{label:t("\u898f\u5283"),component:f.b,to:"/".concat(n.language,"/search"),onClick:function(e){return u("/".concat(n.language,"/search"),e)},value:"/".concat(n.language,"/search"),icon:Object(R.jsx)(K.a,{}),classes:{root:"footer-actionItem",selected:"footer-selected"}}),Object(R.jsx)(P.a,{label:t("\u8a2d\u5b9a"),component:f.b,to:"/".concat(n.language,"/settings"),rel:"nofollow",onClick:function(e){return u("/".concat(n.language,"/settings"),e)},value:"/".concat(n.language,"/settings"),icon:Object(R.jsx)($.a,{}),classes:{root:"footer-actionItem",selected:Z.selected}})]})}),[a.pathname,n.language,i,r])},G="footer",Z={root:"".concat(G,"-root"),selected:"".concat(G,"-selected")},Q=Object(y.a)(z.a)((function(e){var t,n=e.theme;return Object(d.a)({},"&.".concat(Z.root),(t={background:"dark"===n.palette.mode?n.palette.background.default:n.palette.primary.main,position:"sticky",bottom:"0",height:"initial"},Object(d.a)(t,"& .MuiBottomNavigationAction-root",{width:"20%",minWidth:0}),Object(d.a)(t,"& .Mui-selected.".concat(Z.selected),{color:"dark"===n.palette.mode?n.palette.primary.main:n.palette.text.primary}),t))})),X=n(25),ee=n(284),te=n(285),ne=n(260),ae=n(282),oe=n(283),ce=n(272),re=n(100),ie=function(e){var t=e.routeId,n=Object(T.a)(),a=n.t,c=n.i18n,r=Object(o.useContext)(w.b).etaFormat,i=Object(re.a)(t),s=function(e){if(e&&e.eta){var t=Math.round((new Date(e.eta).getTime()-(new Date).getTime())/60/1e3);return"exact"===r&&Number.isInteger(t)?e.eta.substr(11,5):t<1?"- ".concat(a("\u5206\u9418")):Number.isInteger(t)?"".concat(t," ").concat(a("\u5206\u9418")):e.remark[c.language]}return""};return Object(R.jsx)(le,{primary:Object(R.jsx)(k.a,{component:"h5",color:"textPrimary",children:i?s(i[0]):""}),secondary:Object(R.jsx)(k.a,{component:"h6",color:"textSecondary",className:ue.secondary,children:i?s(i[1]):""}),className:ue.root})},se="etas",ue={root:"".concat(se,"-root"),secondary:"".concat(se,"-secondary")},le=Object(y.a)(ae.a)((function(e){var t;e.theme;return t={},Object(d.a)(t,"&.".concat(ue.root),{width:"20%",paddingLeft:"10px",textAlign:"right"}),Object(d.a)(t,"& .".concat(ue.secondary),{fontSize:"0.875rem",fontWeight:"400",lineHeight:"1.43"}),t})),de=n(84),be=function(e){var t=e.name,n=e.location,a=e.fares,c=e.faresHoliday,r=e.seq,i=Object(T.a)().t,s=Object(o.useContext)(w.b),u=s.geoPermission,l=s.geolocation,d=[a&&a[r]?"$"+a[r]:"",c&&c[r]?"$"+c[r]:""].filter((function(e){return e})).join(", ");return"granted"!==u||0===n.lat?Object(R.jsx)(R.Fragment,{children:t+"\u3000"+(d?"("+d+")":"")}):Object(R.jsx)(R.Fragment,{children:t+" - "+Object(L.c)(n,l).toFixed(0)+i("\u7c73")+"\u3000"+(d?"("+d+")":"")})},pe={co:[""],stops:{"":[""]},dest:{zh:"",en:""},bound:"",nlbId:0,fares:[],faresHoliday:[]},ge={location:{lat:0,lng:0},name:{zh:"",en:""}},me=function(e){var t=e.routeId,n=Object(T.a)(),c=n.t,r=n.i18n,i=Object(o.useContext)(w.b).db,s=i.routeList,u=i.stopList,l=t.split("-"),d=Object(a.a)(l,1)[0],b=t.split("/"),p=Object(a.a)(b,2),g=p[0],m=p[1],h=s[g]||pe,O=h.co,v=h.stops,x=h.dest,y=h.fares,C=h.faresHoliday,S=u[je(O,v)[parseInt(m,10)]]||ge,I=Object(j.g)();return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)(Oe,{component:f.b,to:"/".concat(r.language,"/route/").concat(g.toLowerCase()),onClick:function(e){e.preventDefault(),Object(L.i)(1),setTimeout((function(){I.push("/".concat(r.language,"/route/").concat(t.toLowerCase()))}),0)},className:he.listItem,children:[Object(R.jsx)(ae.a,{primary:Object(R.jsx)(de.a,{routeNo:d}),className:he.route}),Object(R.jsx)(ae.a,{primary:Object(R.jsxs)(k.a,{component:"h3",variant:"body1",color:"textPrimary",className:he.fromToWrapper,children:[Object(R.jsx)("span",{className:he.fromToText,children:c("\u5f80")}),Object(R.jsx)("b",{children:Object(L.g)(x[r.language])})]}),secondary:Object(R.jsx)(be,{name:Object(L.g)(S.name[r.language]),location:S.location,fares:y,faresHoliday:C,seq:parseInt(m,10)}),secondaryTypographyProps:{component:"h4",variant:"subtitle2"},className:he.routeDest}),Object(R.jsx)(ie,{routeId:t})]}),Object(R.jsx)(oe.a,{})]})},je=function(e,t){for(var n=0;n<e.length;++n)if(e[n]in t)return t[e[n]]},fe="succinctTimeReport",he={listItem:"".concat(fe,"-listItem"),route:"".concat(fe,"-route"),routeDest:"".concat(fe,"-routeDest"),fromToWrapper:"".concat(fe,"-fromToWrapper"),fromToText:"".concat(fe,"-fromToText")},Oe=Object(y.a)(ce.a)((function(e){var t,n=e.theme;return t={},Object(d.a)(t,"&.".concat(he.listItem),{padding:"4px 16px",color:"rgba(0,0,0,0.87)"}),Object(d.a)(t,"& .".concat(he.route),{width:"15%"}),Object(d.a)(t,"& .".concat(he.routeDest),{width:"65%"}),Object(d.a)(t,"& .".concat(he.fromToWrapper),{display:"flex",alignItems:"baseline"}),Object(d.a)(t,"& .".concat(he.fromToText),{fontSize:"0.85rem",marginRight:n.spacing(.5)}),t})),ve=n(150),xe=n.n(ve),ye=n(112),we=function(){var e=Object(o.useContext)(w.b),t=e.AppTitle,n=e.geolocation,c=e.hotRoute,r=e.savedEtas,i=e.db,s=i.holidays,u=i.routeList,l=i.stopList,d=e.isRouteFilter,b=Object(T.a)(),p=b.t,g=b.i18n,m=Object(ye.a)(s,new Date),j=Object(o.useState)(ke({geolocation:n,hotRoute:c,savedEtas:r,routeList:u,stopList:l,isRouteFilter:d,isTodayHoliday:m})),f=Object(a.a)(j,2),h=f[0],O=f[1],v=Object(o.useRef)(xe()((function(e){var t=ke({geolocation:e,hotRoute:c,savedEtas:r,routeList:u,stopList:l,isRouteFilter:d,isTodayHoliday:m});t!==h&&O(t)}),6e4)).current;return Object(o.useEffect)((function(){Object(L.f)({title:"".concat(p("Dashboard")," - ").concat(p(t)),description:p("home-page-description"),lang:g.language})}),[g.language]),Object(o.useEffect)((function(){v(n)}),[n]),Object(o.useMemo)((function(){return Object(R.jsxs)(Se,{className:Ce.root,square:!0,elevation:0,children:[Object(R.jsx)(k.a,{component:"h1",style:ne.a,children:"".concat(p("Dashboard")," - ").concat(p(t))}),Object(R.jsx)(k.a,{component:"h2",style:ne.a,children:p("home-page-description")}),Object(R.jsx)(ee.a,{disablePadding:!0,children:h.split("|").map((function(e,t){return Object(R.jsx)(me,{routeId:e},"route-shortcut-".concat(t))}))})]})}),[h])},ke=function(e){var t=e.hotRoute,n=e.savedEtas,o=e.geolocation,c=e.stopList,r=e.routeList,i=e.isRouteFilter,s=e.isTodayHoliday,u=n.concat(Object.entries(t).filter((function(e){var t=Object(a.a)(e,2);t[0];return t[1]>5})).sort((function(e,t){return t[1]-e[1]})).map((function(e){return Object(a.a)(e,1)[0]}))).filter((function(e,t,n){return n.indexOf(e)===t&&e.split("/")[0]in r})).map((function(e){var t=e.split("/"),n=Object(a.a)(t,2),i=n[0],s=n[1],u=c[Object.values(r[i].stops).sort((function(e,t){return t.length-e.length}))[0][s]];return[e,Object(L.c)(o,u.location)]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]})).slice(0,20),l=Object.entries(c).map((function(e){return[].concat(Object(X.a)(e),[Object(L.c)(e[1].location,o)])})).filter((function(e){return e[2]<1e3})).sort((function(e,t){return e[2]-t[2]})).slice(0,5).reduce((function(e,t){var n=Object(a.a)(t,1)[0],o=[];return Object.entries(r).forEach((function(e){var t=Object(a.a)(e,2),c=t[0],r=t[1];["kmb","nwfb","ctb","nlb"].forEach((function(e){r.stops[e]&&r.stops[e].includes(n)&&o.push(c+"/"+r.stops[e].indexOf(n))}))})),e.concat(o)}),[]);return u.concat(l).filter((function(e,t,n){return n.indexOf(e)===t})).filter((function(e){var t=e.split("/"),n=Object(a.a)(t,1)[0];return!i||Object(ye.b)(r[n].freq,s)})).concat(Array(20).fill("")).slice(0,20).join("|")},Ce={root:"".concat("home","-root")},Se=Object(y.a)(te.a)((function(e){var t=e.theme;return Object(d.a)({},"&.".concat(Ce.root),{background:"dark"===t.palette.mode?t.palette.background.default:"white",height:"calc(100vh - 125px)",overflowY:"scroll",textAlign:"center"})})),Ie=n(295),Me=n(261),Te=n(262),Le=n(263),Re=n(296),Ne=n(151),Ee=n(286),Ae=n(136),Be=n.n(Ae),Fe=function(){var e=Object(o.useContext)(w.b),t=e.geolocation;return"granted"!==e.geoPermission?null:Object(R.jsx)(Ie.a,{center:Object(L.b)(t),radius:25})},Pe=function(e){var t=e.onClick;return Object(R.jsx)("div",{className:"leaflet-bottom leaflet-right",children:Object(R.jsx)(Ke,{className:"".concat(qe.centerControlContainer," leaflet-control leaflet-bar"),onClick:t,children:Object(R.jsx)(Be.a,{className:qe.centerControl})})})},ze=function(e){var t=e.stops,n=e.stopIdx,a=e.onMarkerClick,c=Object(o.useContext)(w.b),r=c.geolocation,i=c.geoPermission,s=c.updateGeoPermission,d=c.colorMode,b=Object(T.a)().i18n,p=Object(o.useRef)({initialCenter:t[n]?t[n].location:Object(L.b)(),currentStopCenter:t[n]?t[n].location:Object(L.b)(),center:t[n]?t[n].location:Object(L.b)(),isFollow:!1,stops:t,stopIdx:n});Object(o.useEffect)((function(){var e,a;e=p.current.stops===t&&p.current.stopIdx===n&&p.current.isFollow,a=p.current.stops===t&&p.current.stopIdx===n&&e?r:t[n]?t[n].location:Object(L.b)();var o,c,i=p.current.center;i===a||Object(L.e)(a,i)||(p.current.stops!==t?null===(o=p.current.map)||void 0===o||o.setView(a):null===(c=p.current.map)||void 0===c||c.flyTo(a));p.current=Object(l.a)(Object(l.a)({},p.current),{},{center:a,currentStopCenter:t[n]?t[n].location:Object(L.b)(),stops:t,stopIdx:n,isFollow:e})}),[t,n,r]);var g=Object(o.useCallback)((function(e){console.log("got map",e),p.current=Object(l.a)(Object(l.a)({},p.current),{},{map:e});var t=function(){p.current=Object(l.a)(Object(l.a)({},p.current),{},{center:p.current.currentStopCenter,isFollow:!1})};e.on({dragend:t,dragstart:t}),"prerendering"===navigator.userAgent?e.setView(p.current.center,11):e.setView(p.current.center),console.log("try invalidateSize"),e.invalidateSize()}),[]),m=Object(o.useCallback)((function(){console.log("map is ready")}),[]),j=Object(o.useCallback)((function(){var e;"granted"===i?(null===(e=p.current.map)||void 0===e||e.flyTo(r),p.current=Object(l.a)(Object(l.a)({},p.current),{},{center:r,isFollow:!0})):"denied"!==i&&(p.current=Object(l.a)(Object(l.a)({},p.current),{},{isFollow:!0}),s("opening"))}),[i,r,s]),f=Object(o.useMemo)((function(){return t.map((function(e,t){return Object(R.jsx)(Me.a,{position:e.location,icon:He({active:t===n,passed:t<n}),alt:"".concat(t,". ").concat(e.name[b.language]),eventHandlers:{click:function(e){a(t,e)}}},"".concat(e.location.lng,"-").concat(e.location.lat,"-").concat(t))}))}),[b.language,a,n,t]),h=Object(o.useMemo)((function(){return t.reduce((function(e,t,n,a){if(0===n)return e;var o=a[n-1];return void 0===o?(console.log("wat?",a,n),e):(e.push(Object(R.jsx)(Te.a,{positions:[De(o.location),De(t.location)],color:"#FF9090"},"".concat(t.location.lng,"-").concat(t.location.lat,"-line"))),e)}),[])}),[t]);return Object(R.jsx)(Ue,{className:qe.mapContainerBox,children:Object(R.jsxs)(Le.a,{center:p.current.initialCenter,zoom:16,scrollWheelZoom:!1,className:qe.mapContainer,whenCreated:g,whenReady:m,children:[Object(R.jsx)(Re.a,{crossOrigin:"anonymous",detectRetina:!0,maxZoom:u.a.Browser.retina?20:19,maxNativeZoom:18,keepBuffer:10,updateWhenIdle:!1,attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"light"===d?"https://cartodb-basemaps-a.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png":"https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png"}),f,h,Object(R.jsx)(Fe,{}),Object(R.jsx)(Pe,{onClick:j})]})})},De=function(e){return[e.lat,e.lng]},He=function(e){var t=e.active,n=e.passed;return u.a.divIcon({iconSize:[25,41],iconAnchor:[12.5,41],className:"".concat(qe.marker," ").concat(t?qe.active:""," ").concat(n?qe.passed:"")})},We="routeMap",qe={mapContainerBox:"".concat(We,"-mapContainerBox"),mapContainer:"".concat(We,"-mapContainer"),centerControlContainer:"".concat(We,"-centerControlContainer"),centerControl:"".concat(We,"-centerControl"),marker:"".concat(We,"-marker"),active:"".concat(We,"-active"),passed:"".concat(We,"-passed")},Ue=Object(y.a)(Ee.a)((function(e){var t,n=e.theme;return t={},Object(d.a)(t,"&.".concat(qe.mapContainerBox),{height:"30vh",filter:"dark"===n.palette.mode?"brightness(0.8)":"none"}),Object(d.a)(t,"& .".concat(qe.mapContainer),{height:"30vh"}),Object(d.a)(t,"& .".concat(qe.marker),{width:"25px",height:"41px",zIndex:618,outline:"none",filter:"hue-rotate(130deg)",backgroundImage:"url(".concat(Ne.a,")"),backgroundSize:"cover"}),Object(d.a)(t,"& .".concat(qe.active),{animation:"blinker 2s linear infinite"}),Object(d.a)(t,"& .".concat(qe.passed),{filter:"grayscale(100%)"}),t})),Ke=Object(y.a)("div")((function(e){var t;e.theme;return t={},Object(d.a)(t,"& .".concat(qe.centerControl),{padding:"5px",color:"black"}),Object(d.a)(t,"&.".concat(qe.centerControlContainer),{background:"white",height:"28px",marginBottom:"20px !important",marginRight:"5px !important"}),t})),Je=n(287),Ve=n(271),_e=n(273),$e=n(288),Ye=n(289),Ge=n(153),Ze=n.n(Ge),Qe=n(154),Xe=n.n(Qe),et=n(137),tt=n(152),nt=n.n(tt),at=function(e){var t=e.routeId,n=e.stopIdx,c=e.expanded,r=e.routeListEntry,i=e.stopListExtracted,s=e.handleChange,u=t,l=Object(o.useContext)(w.b),d=l.AppTitle,b=l.savedEtas,p=l.updateSavedEtas,g=l.energyMode,m=Object(o.useState)(!1),j=Object(a.a)(m,2),f=j[0],h=j[1],O=r.route,v=r.dest,x=r.fares,y=r.faresHoliday,C=Object(T.a)(),S=C.t,I=C.i18n,M=Object(o.useRef)([]);Object(o.useEffect)((function(){var e;c&&M.current[n]&&(null===(e=M.current[n])||void 0===e||e.scrollIntoView({behavior:"smooth",block:"nearest"}))}),[c,n]);var N=Object(o.useMemo)((function(){return i.map((function(e,t){return Object(R.jsxs)(it,{expanded:n===t&&c,onChange:function(e,n){s(t,n)},TransitionProps:{unmountOnExit:!0},ref:function(e){e instanceof HTMLElement&&(M.current[t]=e,n===t&&e.scrollIntoView({behavior:"smooth",block:"nearest"}))},classes:{root:ct.accordionRoot,expanded:ct.accordionExpanded},children:[Object(R.jsxs)(st,{classes:{root:ct.accordionSummaryRoot,content:ct.accordionSummaryContent,expanded:ct.accordionSummaryExpanded},children:[Object(R.jsxs)(k.a,{component:"h3",variant:"body1",children:[t+1,". ",Object(L.g)(e.name[I.language])]}),Object(R.jsxs)(k.a,{variant:"caption",children:[x&&x[t]?S("\u8eca\u8cbb")+": $"+x[t]:"",y&&y[t]?"\u3000\u3000\u3000\u3000"+S("\u5047\u65e5\u8eca\u8cbb")+": $"+y[t]:""]})]}),Object(R.jsxs)(ut,{classes:{root:ct.accordionDetailsRoot},children:[Object(R.jsx)(et.a,{routeId:"".concat(u.toUpperCase()),seq:t}),Object(R.jsxs)("div",{style:{display:"flex"},children:[Object(R.jsx)(Je.a,{"aria-label":"share",onClick:function(){Object(L.h)("https://".concat(window.location.hostname,"/").concat(I.language,"/").concat(u),"".concat(t+1,". ").concat(Object(L.g)(e.name[I.language])," - ").concat(O," ").concat(S("\u5f80")," ").concat(Object(L.g)(v[I.language])," - ").concat(S(d))).then((function(){navigator.clipboard&&h(!0)}))},style:{backgroundColor:"transparent"},size:"large",children:Object(R.jsx)(nt.a,{})}),Object(R.jsx)(Je.a,{"aria-label":"favourite",onClick:function(){return p("".concat(u.toUpperCase(),"/").concat(t))},style:{backgroundColor:"transparent"},size:"large",children:b.includes("".concat(u.toUpperCase(),"/").concat(t))?Object(R.jsx)(Ze.a,{}):Object(R.jsx)(Xe.a,{})})]})]})]},"stop-"+t)}))}),[d,v,c,x,y,s,I.language,u,O,b,n,i,S,p]);return Object(R.jsxs)(rt,{className:g?ct.boxContainerEnergy:ct.boxContainer,children:[N,Object(R.jsx)(Ve.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:f,autoHideDuration:1500,onClose:function(){h(!1)},message:S("\u93c8\u7d50\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f")})]})},ot="stopAccordions",ct={boxContainer:"".concat(ot,"-boxContainer"),boxContainerEnergy:"".concat(ot,"-boxContainerEnergy"),accordionRoot:"".concat(ot,"-accordion-root"),accordionExpanded:"".concat(ot,"-accordion-expanded"),accordionSummaryRoot:"".concat(ot,"-summary-root"),accordionSummaryContent:"".concat(ot,"-summary-content"),accordionSummaryExpanded:"".concat(ot,"-summary-expanded"),accordionDetailsRoot:"".concat(ot,"-details-root")},rt=Object(y.a)(Ee.a)((function(e){var t;e.theme;return t={},Object(d.a)(t,"&.".concat(ct.boxContainer),{overflowY:"scroll",height:"calc(100vh - 30vh - 47px)"}),Object(d.a)(t,"&.".concat(ct.boxContainerEnergy),{overflowY:"scroll",height:"calc(100vh - 47px)"}),t})),it=Object(y.a)(_e.a)((function(e){e.theme;return Object(d.a)({},"&.".concat(ct.accordionRoot),Object(d.a)({border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"}},"&.".concat(ct.accordionExpanded),{margin:"auto"}))})),st=Object(y.a)($e.a)((function(e){var t,n=e.theme;return Object(d.a)({},"&.".concat(ct.accordionSummaryRoot),(t={backgroundColor:"dark"===n.palette.mode?n.palette.background.default:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:44},Object(d.a)(t,"&.".concat(ct.accordionSummaryExpanded),{minHeight:44}),Object(d.a)(t,"& .".concat(ct.accordionSummaryContent),Object(d.a)({margin:"8px 0",flexDirection:"column"},"&.".concat(ct.accordionSummaryExpanded),{margin:"8px 0"})),t))})),ut=Object(y.a)(Ye.a)((function(e){var t=e.theme;return Object(d.a)({},"&.".concat(ct.accordionDetailsRoot),{padding:t.spacing(2),paddingTop:t.spacing(1),paddingBottom:t.spacing(1),justifyContent:"space-between",display:"flex"})})),lt=n(290),dt=n(291),bt=n(292),pt="stopDialog",gt={root:"".concat(pt,"-root"),title:"".concat(pt,"-title")},mt=Object(y.a)(bt.a)((function(e){var t,n=e.theme;return t={},Object(d.a)(t,"&.".concat(gt.root),{"& .MuiPaper-root":{width:"100%",marginTop:"90px",height:"calc(100vh - 100px)"}}),Object(d.a)(t,"& .".concat(gt.title),{backgroundColor:"dark"===n.palette.mode?n.palette.background.default:n.palette.primary.main,color:"dark"===n.palette.mode?n.palette.primary.main:n.palette.text.primary}),t})),jt=function(e){var t=e.open,n=e.stops,c=e.handleClose,r=Object(o.useContext)(w.b).db,i=r.routeList,s=r.stopList,u=Object(T.a)().i18n,l=Object(o.useState)([]),d=Object(a.a)(l,2),b=d[0],p=d[1];return Object(o.useEffect)((function(){if(void 0!==n){var e=[];Object.entries(i).forEach((function(t){var o=Object(a.a)(t,2),c=o[0],r=o[1];n.some((function(t){var n=Object(a.a)(t,2),o=n[0],i=n[1];return!(!r.stops[o]||!r.stops[o].includes(i))&&(e.push(c+"/"+r.stops[o].indexOf(i)),!0)}))})),p(e)}else p([])}),[n]),Object(R.jsxs)(mt,{open:t,onClose:c,className:gt.root,children:[Object(R.jsx)(lt.a,{className:gt.title,children:s[n[0][1]].name[u.language]}),Object(R.jsx)(dt.a,{children:Object(R.jsx)(ee.a,{children:b.map((function(e){return Object(R.jsx)(me,{routeId:e},e)}))})})]})},ft=n(293),ht=n(155),Ot=n.n(ht),vt=n(276),xt={31:"\u661f\u671f\u4e00\u81f3\u4e94",287:"\u661f\u671f\u4e00\u81f3\u4e94",415:"\u661f\u671f\u4e00\u81f3\u4e94",63:"\u661f\u671f\u4e00\u81f3\u516d",319:"\u661f\u671f\u4e00\u81f3\u516d",447:"\u661f\u671f\u4e00\u81f3\u516d",416:"\u661f\u671f\u516d\u81f3\u65e5",480:"\u661f\u671f\u516d\u81f3\u65e5",266:"\u661f\u671f\u4e8c\u81f3\u56db",271:"\u661f\u671f\u4e00\u81f3\u56db",272:"\u661f\u671f\u4e94",288:"\u661f\u671f\u516d",320:"\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f",448:"\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f",511:"\u6240\u6709\u65e5\u5b50"},yt=function(e){var t=e.freq,n=e.jt,c=e.open,r=e.onClose,i=Object(T.a)().t,s=Object(o.useMemo)((function(){return Object.entries(t).map((function(e){var t=Object(a.a)(e,2),n=t[0],o=t[1];return Object(R.jsxs)(ce.a,{className:kt.entries,children:[Object(R.jsx)(k.a,{variant:"subtitle1",children:i(xt[n])}),Object.entries(o).sort((function(e,t){return e[0]<t[0]?-1:1})).map((function(e){var t=Object(a.a)(e,2),o=t[0],c=t[1];return Object(R.jsxs)("div",{className:kt.freqContainer,children:[Object(R.jsxs)(k.a,{variant:"caption",children:[o," ",c?"-".concat(c[0]):""]}),c?Object(R.jsxs)(k.a,{variant:"caption",children:[parseInt(c[1],10)/60,i("\u5206\u9418")]}):Object(R.jsx)(R.Fragment,{})]},"".concat(n,"-").concat(o))}))]},"".concat(n))}))}),[t,i]),u=Object(o.useMemo)((function(){return{onClose:function(){r()}}}),[r]),l=Object(o.useMemo)((function(){return{className:"timetable-drawer"}}),[]);return Object(R.jsxs)(Ct,{open:c,ModalProps:u,PaperProps:l,anchor:"right",children:[n?Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(ce.a,{className:kt.entries,children:Object(R.jsxs)("div",{className:kt.jtContainer,children:[Object(R.jsx)(k.a,{variant:"subtitle1",children:i("\u8eca\u7a0b")}),Object(R.jsxs)(k.a,{variant:"subtitle1",children:[n,i("\u5206\u9418")]})]})}),Object(R.jsx)(oe.a,{className:kt.divider})]}):null,Object(R.jsx)(ee.a,{children:s})]})},wt="timetable",kt={drawer:"".concat(wt,"-drawer"),entries:"".concat(wt,"-entries"),jtContainer:"".concat(wt,"-jtContainer"),divider:"".concat(wt,"-divider"),freqContainer:"".concat(wt,"-freqContainer")},Ct=Object(y.a)(vt.a)((function(e){var t,n=e.theme;return t={},Object(d.a)(t,"& .".concat(kt.drawer),{height:"100vh",width:"80%",maxWidth:"320px",paddingTop:"56px",paddingLeft:"20px",backgroundColor:"dark"===n.palette.mode?n.palette.background.default:n.palette.primary.main,backgroundImage:"none"}),Object(d.a)(t,"& .".concat(kt.jtContainer),{display:"flex",justifyContent:"space-between",width:"80%"}),Object(d.a)(t,"& .".concat(kt.divider),{width:"80%"}),Object(d.a)(t,"& .".concat(kt.entries),{flexDirection:"column",alignItems:"flex-start"}),Object(d.a)(t,"& .".concat(kt.freqContainer),{display:"flex",justifyContent:"space-between",width:"80%"}),t})),St=function(e,t){for(var n=0;n<e.length;++n)if(e[n]in t)return t[e[n]];return[]},It=function(e,t,n,a){for(var o=0;o<e.length;++o)if(e[o]in t)return[[e[o],t[e[o]][a]]].concat(n[t[e[o]][a]]||[])},Mt=function(){var e=Object(j.i)(),t=e.id,n=e.panel,c=Object(o.useContext)(w.b),r=c.AppTitle,i=c.db,s=i.routeList,l=i.stopList,d=i.stopMap,b=c.updateSelectedRoute,p=c.energyMode,g=c.workbox,m=c.geoPermission,f=c.geolocation,h=s[t.toUpperCase()],O=h.route,v=h.stops,x=h.co,y=h.orig,C=h.dest,S=h.nlbId,I=h.fares,M=h.freq,N=h.jt,E=Object(o.useMemo)((function(){return St(x,v).map((function(e){return l[e]})).filter((function(e){return null!==e&&void 0!==e}))}),[x,l,v]),A=0;if(void 0!==n)A=parseInt(n,10);else if("granted"===m){var B=E.map((function(e,t){return[t,Object(L.c)(f,e.location)]})).sort((function(e,t){return e[1]-t[1]}))[0];A=B.length>0?B[0]:0}else A=0;var F=Object(o.useState)(!0),P=Object(a.a)(F,2),z=P[0],D=P[1],H=Object(o.useState)(!1),W=Object(a.a)(H,2),q=W[0],U=W[1],K=Object(o.useState)(!1),J=Object(a.a)(K,2),V=J[0],_=J[1],$=Object(o.useMemo)((function(){return It(x,v,d,String(A))}),[x,A,d,v]),Y=Object(T.a)(),G=Y.t,Z=Y.i18n,Q=Object(j.g)(),X=Object(o.useCallback)((function(e,n){n&&A!==e&&Q.replace("/".concat(Z.language,"/route/").concat(t,"/").concat(e)),A!==e||n?D(n):U(!0)}),[Q,Z.language,t,A]),ee=Object(o.useCallback)((function(e){A===e&&U(!0),Q.replace("/".concat(Z.language,"/route/").concat(t,"/").concat(e))}),[Q,Z.language,t,A]),te=Object(o.useCallback)((function(){U(!1)}),[]);return Object(o.useEffect)((function(){U(!1),document.getElementById(t).setAttribute("value",t),b(t)}),[t,b]),Object(o.useEffect)((function(){Object(L.f)({title:O+" "+G("\u5f80")+" "+Object(L.g)(C[Z.language])+" - "+G(r),description:function(){var e=I?I.filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return"$".concat(e)})):[];return"zh"===Z.language?"\u8def\u7dda".concat(O)+"\u7531".concat(y.zh,"\u51fa\u767c\uff0c\u4ee5").concat(C.zh,"\u70ba\u7d42\u9ede\uff0c")+(e.length?"\u5206\u6bb5\u8eca\u8cbb\u70ba".concat(e.join("\u3001"),"\uff0c"):"")+"\u9014\u7d93".concat(E.map((function(e){return e.name.zh})).join("\u3001"),"\u3002"):"Route ".concat(O," ")+"is from ".concat(Object(L.g)(y.en)," to ").concat(Object(L.g)(C.en))+(e.length?", section fees are ".concat(e.join(", "),". "):". ")+"Stops: "+Object(L.g)(E.map((function(e){return e.name.en})).join(", "))+". "}(),lang:Z.language})}),[r,C,I,Z.language,y.en,y.zh,O,E,G]),Object(o.useEffect)((function(){if(!p){var e={type:"WARN_UP_MAP_CACHE",retinaDisplay:u.a.Browser.retina,zoomLevels:[14,15,16,17,18],stopList:St(x,v).map((function(e){return l[e]})).filter((function(e){return null!==e&&void 0!==e}))};null===g||void 0===g||g.messageSW(e)}}),[x,p,l,v,g]),Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("input",{hidden:!0,id:t}),Object(R.jsxs)(Lt,{className:Tt.header,elevation:0,children:[Object(R.jsx)(de.a,{routeNo:O,component:"h1",align:"center"}),Object(R.jsxs)(k.a,{component:"h2",variant:"caption",align:"center",children:[G("\u5f80")," ",Object(L.g)(C[Z.language])," ",S?G("\u7531")+" "+Object(L.g)(y[Z.language]):""]}),M?Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(Rt,{orientation:"vertical",className:Tt.buttonDivider}),Object(R.jsx)(Nt,{variant:"text","aria-label":"open-timetable",className:Tt.timeTableButton,size:"small",startIcon:Object(R.jsx)(Ot.a,{}),onClick:function(){return _(!0)},children:G("\u6642\u9593\u8868")}),Object(R.jsx)(yt,{freq:M,jt:N,open:V,onClose:function(){return _(!1)}})]}):Object(R.jsx)(R.Fragment,{})]}),p?Object(R.jsx)(R.Fragment,{}):Object(R.jsx)(ze,{stops:E,stopIdx:A,onMarkerClick:ee}),Object(R.jsx)(at,{routeId:t,stopIdx:A,routeListEntry:h,stopListExtracted:E,expanded:z,handleChange:X}),Object(R.jsx)(jt,{open:q,stops:$,handleClose:te})]})},Tt={header:"".concat("route","-header"),buttonDivider:"timetable-button-divider",timeTableButton:"timetable-button"},Lt=Object(y.a)(te.a)((function(e){e.theme;return Object(d.a)({},"&.".concat(Tt.header),{textAlign:"center",background:"transparent",position:"relative"})})),Rt=Object(y.a)(oe.a)((function(e){e.theme;return Object(d.a)({},"&.".concat(Tt.buttonDivider),{position:"absolute",top:"0",right:"calc(64px + 2%)"})})),Nt=Object(y.a)(ft.a)((function(e){var t=e.theme;return Object(d.a)({},"&.".concat(Tt.timeTableButton),{color:t.palette.getContrastText(t.palette.background.default),position:"absolute",top:"0",right:"2%",flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}})})),Et=n(138),At=Object(b.a)((function(){return Promise.all([n.e(4),n.e(5)]).then(n.bind(null,316))})),Bt=Object(b.a)((function(){return Promise.all([n.e(3),n.e(6)]).then(n.bind(null,315))})),Ft=Object(b.a)((function(){return n.e(7).then(n.bind(null,314))})),Pt=function(){var e=Object(j.j)().path;return Object(R.jsx)(Et.a,{children:Object(R.jsxs)(j.d,{children:[Object(R.jsx)(j.b,{path:"".concat(e,"/route/:id/:panel?"),component:Mt}),Object(R.jsx)(j.b,{path:"".concat(e,"/settings"),component:Ft}),Object(R.jsx)(j.b,{path:"".concat(e,"/board"),component:At}),Object(R.jsx)(j.b,{path:"".concat(e,"/search"),component:Bt}),Object(R.jsx)(j.b,{path:"".concat(e),component:we})]})})},zt=function(){var e=Object(o.useContext)(w.b).colorMode,t=Object(o.useMemo)((function(){return Object(p.a)(qt(e),[e])}),[e]);return Object(R.jsx)(g.a,{injectFirst:!0,children:Object(R.jsx)(m.a,{theme:t,children:Object(R.jsx)(h.a,{value:Wt,children:Object(R.jsx)(Ht,{maxWidth:"xs",disableGutters:!0,className:Dt.container,children:Object(R.jsxs)(f.a,{children:[Object(R.jsx)(j.b,{exact:!0,path:"/",children:Object(R.jsx)(j.a,{to:"/zh"})}),Object(R.jsxs)(j.b,{path:"/:lang",children:[Object(R.jsx)(v.a,{}),Object(R.jsx)(N,{}),Object(R.jsx)(Pt,{}),Object(R.jsx)(Y,{})]})]})})})})})},Dt={container:"".concat("app","-container")},Ht=Object(y.a)(x.a)((function(e){e.theme;return Object(d.a)({},"&.".concat(Dt.container),{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"})})),Wt=Object(O.a)({key:"hkbus",speedy:!("prerendering"===navigator.userAgent)}),qt=function(e){return{typography:{fontFamily:"Noto Sans TC, Chivo, sans-serif"},palette:Object(l.a)({mode:e},"light"===e?{background:{default:"#fedb00"},primary:{main:"#fedb00"}}:{primary:{main:"#fedb00"},background:{default:"#000"}}),components:{MuiCssBaseline:{styleOverrides:{html:{userSelect:"none"},body:{fontSize:"0.875rem",lineHeight:1.43}}}}}},Ut=n(80),Kt=n(118),Jt=n(81),Vt=n(156),_t="en"===window.location.pathname.substr(1,2)?"en":"zh";Kt.a.use(Jt.e).init({resources:Vt,whitelist:["en","zh"],lowerCaseLng:!0,lng:_t,nsSeparator:!1,keySeparator:!1,debug:!1,interpolation:{escapeValue:!1}});Kt.a;var $t=n(94),Yt=n(42),Gt=n.n(Yt),Zt=n(68),Qt=n(117),Xt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)),en=function(){var e=Object(Zt.a)(Gt.a.mark((function e(t){return Gt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=5;break}if(new URL("",window.location.href).origin===window.location.origin){e.next=4;break}return e.abrupt("return",void 0);case 4:return e.abrupt("return",new Promise((function(e,n){window.addEventListener("load",(function(){var a="".concat("","/service-worker.js");Xt?(navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})),nn(a,t).then(e,n)):tn(a,t).then(e,n)}))})));case 5:return e.abrupt("return",void 0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tn=function(){var e=Object(Zt.a)(Gt.a.mark((function e(t,n){var a,o,c;return Gt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Qt.a(t),o=function(e){if(void 0!==e.sw&&n&&n.onUpdate){var t=e.sw;n.onUpdate(a,(function(){return Object(Qt.b)(t,{type:"SKIP_WAITING"})}),t)}},c=function(e){e.isUpdate?window.location.reload():n&&n.onSuccess&&n.onSuccess(a)},a.addEventListener("waiting",o),a.addEventListener("externalwaiting",o),a.addEventListener("controlling",c),e.next=8,a.register();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),nn=function(){var e=Object(Zt.a)(Gt.a.mark((function e(t,n){var a,o;return Gt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{headers:{"Service-Worker":"script"}});case 3:if(a=e.sent,o=a.headers.get("content-type"),404!==a.status&&(null==o||-1!==o.indexOf("javascript"))){e.next=10;break}return navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})),e.abrupt("return",void 0);case 10:return e.abrupt("return",tn(t,n));case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log("No internet connection found. App is running in offline mode.");case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}();var an=function(e){e&&e instanceof Function&&n.e(8).then(n.bind(null,313)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),a(e),o(e),c(e),r(e)}))};if(!navigator.userAgent.match(new RegExp(["googlebot","bingbot","slurp","duckduckbot","baiduspider","yandexbot","facebot","ia_archiver","sitecheckerbotcrawler"].join("|"),"i"))){var on=document.querySelector('link[rel="canonical"]'),cn=document.querySelector("style[prerender]"),rn=en({onUpdate:function(e,t,n){t();var a={type:"WARN_UP_MAP_CACHE",retinaDisplay:u.a.Browser.retina,zoomLevels:[14,15]};e.messageSW(a)}}),sn=Object($t.a)(),un=Promise.all([sn,rn]);"prerendering"===navigator.userAgent||window.location.pathname.includes("/board")||window.location.pathname.includes("/search")||window.location.pathname.includes("/settings")||on instanceof HTMLAnchorElement&&on.href.endsWith(window.location.pathname),cn instanceof HTMLStyleElement&&(cn.innerHTML="");var ln=function(){var e=Object(o.useState)({initialized:!1,workbox:void 0,db:void 0}),t=Object(a.a)(e,2),n=t[0],c=t[1];return Object(o.useEffect)((function(){un.then((function(e){var t=Object(a.a)(e,2),n=t[0],o=t[1];console.log(n),c({initialized:!0,workbox:o,db:n})}))}),[]),n.initialized?Object(R.jsx)(Ut.a,{initialDb:n.db,children:Object(R.jsx)(w.a,{workbox:n.workbox,children:Object(R.jsx)(zt,{})})}):Object(R.jsx)(R.Fragment,{})};i.a.render(Object(R.jsx)(c.a.StrictMode,{children:Object(R.jsx)(ln,{})}),document.getElementById("root")),an((function(e){var t=e.name,n=e.delta,a=e.value,o=e.id;window.gtag?window.gtag("event",t,{value:n,metric_id:o,metric_value:a,metric_delta:n}):console.log("gtag not found")}))}},80:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(7),o=n(0),c=n.n(o),r=n(14),i=n(94),s=n(95),u=n(1),l=c.a.createContext(null),d=function(e){var t=e.initialDb,n=e.children,c=Object(o.useState)(t),d=Object(a.a)(c,2),b=d[0],p=d[1],g=Object(o.useCallback)((function(){return Object(i.a)(!0).then((function(e){return p(e)}))}),[]);Object(o.useEffect)((function(){!b||Object(r.d)(b.routeList)||Object(r.d)(b.stopList)||Object(r.d)(b.stopMap)||setTimeout((function(){localStorage.setItem("db",Object(s.compress)(JSON.stringify(b),{outputEncoding:"Base64"}))}),0)}),[b]);var m=Object(o.useMemo)((function(){return{AppTitle:"\u5df4\u58eb\u5230\u7ad9\u9810\u5831 App \uff08\u514d\u8cbb\u7121\u5ee3\u544a\uff09",db:b,renewDb:g}}),[b,g]);return Object(u.jsx)(l.Provider,{value:m,children:n})};t.b=l},84:function(e,t,n){"use strict";var a=n(3),o=n(7),c=(n(0),n(119)),r=n(5),i=n(1);t.a=function(e){var t=e.routeNo,n=e.component,a=e.align,c=t.match(/[A-Z]+$/)?[t.slice(0,-1),t.slice(-1)]:[t,""],r=Object(o.a)(c,2),s=r[0],d=r[1];return Object(i.jsxs)(l,{component:n||"h2",align:a,variant:"caption",color:"textPrimary",className:u.root,children:[Object(i.jsx)("span",{className:u.prefix,children:s}),Object(i.jsx)("span",{className:u.suffix,children:d})]})};var s="routeNo",u={root:"".concat(s,"-root"),prefix:"".concat(s,"-prefix"),suffix:"".concat(s,"-suffix")},l=Object(r.a)(c.a)((function(e){var t;e.theme;return t={},Object(a.a)(t,"&.".concat(u.root),{lineHeight:"normal",display:"inline"}),Object(a.a)(t,"& .".concat(u.prefix),{fontSize:"1.2rem",fontFamily:'"Oswald", sans-serif'}),Object(a.a)(t,"& .".concat(u.suffix),{fontSize:"0.95rem",fontFamily:'"Oswald", sans-serif'}),t}))},94:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(42),o=n.n(a),c=n(7),r=n(68),i=n(15),s=n(77),u=n(95),l=n(158),d=function(e){return"object"===typeof e&&"routeList"in e&&"stopList"in e&&"stopMap"in e&&"holidays"in e&&Array.isArray(e.holidays)&&e.holidays.length>0},b="1.2.0",p=function(e){try{var t=JSON.parse(Object(u.decompress)(e,{inputEncoding:"Base64"}));return Object(i.a)(Object(i.a)({},t),{},{routeList:Object.keys(t.routeList).sort().reduce((function(e,n){return e[n.replace(/\+/g,"-").replace(/ /g,"-").toUpperCase()]=t.routeList[n],e}),{})})}catch(n){try{return Object(l.a)(JSON.parse(e))}catch(a){return{holidays:[],routeList:{},stopList:{},stopMap:{}}}}},g=function(){var e=Object(r.a)(o.a.mark((function e(){var t,n,a,r,u,l,g,m,j,f,h,O,v,x,y=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=y.length>0&&void 0!==y[0]&&y[0],localStorage.getItem("dbv")!==b&&(console.log("New DB, will refetch data"),localStorage.removeItem("db"),localStorage.removeItem("versionMd5"),localStorage.removeItem("routeList"),localStorage.removeItem("stopList"),localStorage.removeItem("stopMap"),localStorage.setItem("dbv",b)),n=localStorage.getItem("schemaVersion"),a=localStorage.getItem("versionMd5"),r=parseInt(localStorage.getItem("updateTime")||""+Date.now(),10),u=localStorage.getItem("db"),l=function(e){return new Promise((function(t,o){try{if(null===e)o("localStorage is null");else{var c=p(localStorage.getItem("db"));t({schemaVersion:n,versionMd5:a,updateTime:r,holidays:c.holidays,routeList:c.routeList,stopList:c.stopList,stopMap:c.stopMap})}}catch(i){o(i)}}))},null===u||!(!navigator.onLine||!t&&Date.now()-r<6048e5)){e.next=17;break}return e.prev=8,e.next=11,l(u);case 11:return g=e.sent,e.abrupt("return",g);case 15:e.prev=15,e.t0=e.catch(8);case 17:return e.prev=17,e.next=20,Promise.all([fetch("/schema-version.txt").then((function(e){return e.text()})),Object(s.fetchEtaObjMd5)()]);case 20:if(m=e.sent,j=Object(c.a)(m,2),f=j[0],h=j[1],O=t,n!==f&&(O=!0),a!==h&&(O=!0),e.prev=27,O){e.next=34;break}return e.next=31,l(u);case 31:if(v=e.sent,!d(v)){e.next=34;break}return e.abrupt("return",v);case 34:e.next=38;break;case 36:e.prev=36,e.t1=e.catch(27);case 38:return x=Date.now()+"",localStorage.setItem("updateTime",x),e.abrupt("return",new Promise((function(e){var n=setTimeout((function(){if(!t&&null!==u){var n=l(u);d(n)&&e(n)}}),1e3);Object(s.fetchEtaObj)().then((function(e){return Object(i.a)(Object(i.a)({},e),{},{routeList:Object.keys(e.routeList).sort().reduce((function(t,n){return t[n.replace(/\+/g,"-").replace(/ /g,"-").toUpperCase()]=e.routeList[n],t}),{}),schemaVersion:f,versionMd5:h,updateTime:parseInt(x)})})).then((function(t){localStorage.setItem("schemaVersion",f),localStorage.setItem("versionMd5",h),clearTimeout(n),e(t)}))})));case 43:return e.prev=43,e.t2=e.catch(17),console.error("cannot get db",e.t2),e.abrupt("return",{schemaVersion:"",versionMd5:"",updateTime:r,holidays:[],routeList:{},stopList:{},stopMap:{}});case 47:case"end":return e.stop()}}),e,null,[[8,15],[17,43],[27,36]])})));return function(){return e.apply(this,arguments)}}()}},[[222,1,2]]]);